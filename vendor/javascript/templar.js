import e from"path";import t from"fs";import r from"util";import o from"lru-cache";import n from"crypto";var a={};a=Templar;var i=e,l=t,f=r,u=o,c=new u(50),d=new u(500),s=n,p={},m={};Templar.loadFolder=loadFolder;function Templar(e,t,r){if(!r)throw new Error("Please provide options to Templar");var o=r.folder,n=r.engine;if(!n||!o)throw new Error("Templar needs engine and folder options");o=i.resolve(o);m[o]||loadFolder(o);template.available=available;template.has=has;return template;function has(e){e=i.resolve(o,e);return!!p[e]}function available(){return Object.keys(p).filter((function(e){return 0===e.indexOf(o)})).map((function(e){return i.relative(o,e)}))}function template(r,n,a){for(var l=0;l<arguments.length;l++)switch(typeof arguments[l]){case"number":a=arguments[l];break;case"string":r=arguments[l];break;case"object":n=arguments[l];break;default:throw new Error("bad argument to template")}if(!r)throw new Error("no template provided");r=i.resolve(o,r);a||(a=200);n&&"object"===typeof n||(n={});var u=p[r];if(!u)throw new Error("invalid template: "+r);var c=f.inspect(n,true,Infinity,false),d=getETag(u.key+":"+c);if(e.headers["if-none-match"]===d){t.statusCode=304;return t.end()}t.setHeader("etag",d);var s=output(r,n,d);t.statusCode=a||200;var m=t.getHeader("content-type");m||t.setHeader("content-type","text/html");t.end(s)}function output(e,t,r){var o=d.get(r);if(!o){var n={};Object.keys(t).forEach((function(e){n[e]=t[e]}));n.include=include(e,r);o=compile(e)(n);d.set(r,o)}return o}function include(e,t){return function(r,o){var n=f.inspect(o,true,Infinity,false),a=t+r+n;return output(i.resolve(i.dirname(e),r),o||{},a)}}function compile(e){var t=p[e];var r=c.get(e);if(!r){r=n.compile(t.contents,{filename:e});c.set(e,r)}if(!r)throw new Error("failed to compile template: "+e);return r}}function getETag(e){var t=s.createHash("sha1");t.update(e);return'"'+t.digest("base64")+'"'}function loadFolder(e){loadFolder_(e,p,0,10);m[e]=true}function loadFolder_(e,t,r,o){if(!(r>o)){var n=[];l.readdirSync(e).forEach((function(r){r=i.resolve(e,r);var o=l.statSync(r);if(o){if(o.isDirectory())return n.push(r);o.contents=l.readFileSync(r,"utf8");o.key=o.dev+":"+o.ino;t[r]=o}}));n.forEach((function(e){loadFolder_(e,t,r+1,o)}))}}var v=a;export default v;

